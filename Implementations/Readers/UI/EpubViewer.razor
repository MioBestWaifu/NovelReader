@using Maria.Readers.Handlers
@using Maria.Translation.Japanese
@using Microsoft.AspNetCore.Components.Forms
@using System.Diagnostics


@code {
    [Parameter]
    public string PathToFile { get; set; }

    private Epub? book;

    protected override Task OnInitializedAsync()
    {
        JapaneseTranslator.PathToUnidic = "D:\\Programs\\Data\\Unidic";
        JapaneseTranslator.PathToDictionary = "D:\\Programs\\Maria-chan\\Services\\Translation\\JMDict\\";
        JapaneseTranslator.Initialize();
        return base.OnInitializedAsync();
    }

    protected override async Task OnParametersSetAsync()
    {
        Debug.WriteLine("PathToFile: " + PathToFile);

        book = await EpubLoader.LoadEpub(PathToFile);
        LoadChapter(11);
        //Load the epub
        //Format and translate
            //Break the chpter into lines
            //Break lines into sentences using common separators
            //Break sentences into lexeme nodes using the Analyzer
            //Translate significant nodes
            //Join auxiliary nodes to the ones they are modifying
            //Rebuild the lines and display them
    }

    private void NextPage()
    {
        //Move to the next page
    }

    private void PreviousPage()
    {
        //Move to the previous page
    }

    private void NextChapter()
    {
        //Move to the next chapter
    }

    private void PreviousChapter()
    {
        //Move to the previous chapter
    }

    private async void LoadChapter(int chapter)
    {
        //Formatter.Load does not seem like good naming
        await EpubFormatter.LoadChapter(book.TableOfContents[chapter].Item2);
    }
}
